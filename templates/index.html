{% extends 'base.html' %}

{% block title %}MSU Enrollment Advisor - Chat{% endblock %}

{% block extra_css %}
<!-- Include the enhanced chat CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/chat-enhanced.css') }}">
<style>
    .chat-container {
        height: 70vh;
        min-height: 400px;
        display: flex;
        flex-direction: column;
    }

    .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        background-color: #f8f9fa;
        border-radius: 0.5rem;
    }

    .chat-input-container {
        margin-top: 1rem;
    }

    .message {
        margin-bottom: 1rem;
        max-width: 80%;
        clear: both;
    }

    .user-message {
        float: right;
        background-color: #d1e7ff;
        border-radius: 1rem 0 1rem 1rem;
        padding: 0.75rem 1rem;
    }

    .bot-message {
        float: left;
        background-color: #f0f0f0;
        border-radius: 0 1rem 1rem 1rem;
        padding: 0.75rem 1rem;
    }

    .loading-indicator {
        display: none;
        text-align: center;
        padding: 1rem;
    }

    .context-toggle {
        font-size: 0.8rem;
        margin-top: 0.5rem;
        color: #0d6efd;
        cursor: pointer;
    }

    .context-content {
        display: none;
        font-size: 0.85rem;
        margin-top: 0.5rem;
        padding: 0.5rem;
        background-color: #f8f9fa;
        border-radius: 0.5rem;
        border: 1px solid #dee2e6;
    }
</style>
{% endblock %}

{% block content %}
<div class="main-container">
    <div class="chat-section">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-chat-dots-fill me-2"></i><span data-i18n="advisor_title">MSU Enrollment Advisor</span>
                    </h5>
                    <div id="topic-indicator" class="topic-indicator" style="display: none;">Topic</div>
                </div>
                <div class="position-absolute" style="right: 1rem; top: 0.5rem;">
                    <button id="clear-chat" class="btn btn-link text-white p-0 border-0 text-decoration-none" data-i18n="clear_chat">Clear Chat</button>
                </div>
            </div>
            <div class="card-body">
                <div class="chat-container">
                    <div class="chat-messages" id="chat-messages">
                        <!-- Welcome message -->
                        <div class="message bot-message">
                            <div class="message-content">
                                <span data-i18n="welcome_message">Welcome to MSU's 24/7 Enrollment Advisor! I'm here to help you with any questions about programs, fees, requirements, and the application process. As both a counselor and guide, I can recommend suitable programs based on your interests and goals. How can I assist you today?</span>
                            </div>
                        </div>
                        <!-- Messages will be added here dynamically -->
                    </div>

                    <div class="loading-indicator" id="loading-indicator">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden" data-i18n="loading">Loading...</span>
                        </div>
                        <p class="text-muted mt-2" data-i18n="thinking">Thinking...</p>
                    </div>

                    <div class="chat-input-container">
                        <form id="chat-form">
                            <div class="input-group">
                                <input type="text" id="message-input" class="form-control"
                                    placeholder="Type your question here..." data-i18n="input_placeholder" aria-label="Type your question" required>
                                <button class="btn btn-primary" type="submit">
                                    <i class="bi bi-send-fill"></i> <span data-i18n="send">Send</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Suggestions -->
    <div class="suggested-questions">
        <div class="card-header bg-light">
            <h6 class="mb-0" data-i18n="suggested_questions">Suggested Questions</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-12">
                    <div class="d-grid gap-2">
                        <!-- English questions -->
                        <button class="suggested-question-btn text-start" data-i18n="q1" data-language="en">What programs does MSU offer for undergraduate students?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q2" data-language="en">How much are the tuition fees for international students?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q3" data-language="en">What are the admission requirements for the MBA program?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q4" data-language="en">Is there financial aid available for students?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q5" data-language="en">When is the application deadline?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q6" data-language="en">Can you tell me about scholarship opportunities?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q7" data-language="en">What is the application process for international students?</button>
                        
                        <!-- Spanish questions -->
                        <button class="suggested-question-btn text-start" data-i18n="q1" data-language="es">¿Qué programas ofrece MSU para estudiantes de pregrado?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q2" data-language="es">¿Cuánto son las tasas de matrícula para estudiantes internacionales?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q3" data-language="es">¿Cuáles son los requisitos de admisión para el programa MBA?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q4" data-language="es">¿Hay ayuda financiera disponible para estudiantes?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q5" data-language="es">¿Cuál es la fecha límite de solicitud?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q6" data-language="es">¿Puede informarme sobre las oportunidades de becas?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q7" data-language="es">¿Cuál es el proceso de solicitud para estudiantes internacionales?</button>
                        
                        <!-- Chinese questions -->
                        <button class="suggested-question-btn text-start" data-i18n="q1" data-language="zh">MSU为本科生提供哪些课程？</button>
                        <button class="suggested-question-btn text-start" data-i18n="q2" data-language="zh">国际学生的学费是多少？</button>
                        <button class="suggested-question-btn text-start" data-i18n="q3" data-language="zh">MBA课程的入学要求是什么？</button>
                        <button class="suggested-question-btn text-start" data-i18n="q4" data-language="zh">是否有学生经济援助？</button>
                        <button class="suggested-question-btn text-start" data-i18n="q5" data-language="zh">申请截止日期是什么时候？</button>
                        <button class="suggested-question-btn text-start" data-i18n="q6" data-language="zh">能告诉我关于奖学金机会的信息吗？</button>
                        <button class="suggested-question-btn text-start" data-i18n="q7" data-language="zh">国际学生的申请流程是什么？</button>
                        
                        <!-- Malay questions -->
                        <button class="suggested-question-btn text-start" data-i18n="q1" data-language="ms">Apakah program yang ditawarkan MSU untuk pelajar prasiswazah?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q2" data-language="ms">Berapakah yuran pengajian untuk pelajar antarabangsa?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q3" data-language="ms">Apakah syarat kemasukan untuk program MBA?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q4" data-language="ms">Adakah bantuan kewangan tersedia untuk pelajar?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q5" data-language="ms">Bilakah tarikh tutup permohonan?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q6" data-language="ms">Boleh anda beritahu tentang peluang biasiswa?</button>
                        <button class="suggested-question-btn text-start" data-i18n="q7" data-language="ms">Apakah proses permohonan untuk pelajar antarabangsa?</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Include the new chat.js file -->
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}